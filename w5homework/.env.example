# ============================================================================
# PostgreSQL MCP Server - Environment Configuration
# ============================================================================
# Copy this file to .env and configure with your actual values
# DO NOT commit .env to version control - it contains sensitive credentials
# ============================================================================

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# PostgreSQL database connection settings

# Database host (IP address or hostname)
# Examples: localhost, 192.168.1.100, db.example.com, postgres
DATABASE_HOST=localhost

# Database port (default PostgreSQL port is 5432)
DATABASE_PORT=5432

# Database name to connect to
# This should be an existing database that the user has access to
DATABASE_NAME=blog_small

# Database user for authentication
# SECURITY: Use a read-only user in production (see README.md Security section)
DATABASE_USER=postgres

# Database password
# SECURITY: Keep this secure and never commit to version control
DATABASE_PASSWORD=postgres

# ============================================================================
# DATABASE CONNECTION POOL SETTINGS
# ============================================================================
# Configure connection pooling for optimal performance and resource usage

# Minimum number of connections to maintain in the pool
# Lower values save resources, higher values reduce connection setup latency
# Recommended: 5-10 for most use cases
DATABASE_MIN_POOL_SIZE=5

# Maximum number of connections allowed in the pool
# Should be less than PostgreSQL's max_connections setting
# Recommended: 10-50 depending on expected concurrent queries
DATABASE_MAX_POOL_SIZE=20

# Connection pool acquisition timeout in seconds
# How long to wait for an available connection before timing out
# Recommended: 10-30 seconds
DATABASE_POOL_TIMEOUT=30

# Query execution timeout in seconds
# Maximum time a single query can run before being cancelled
# Prevents runaway queries from consuming resources
# Recommended: 30-60 seconds
DATABASE_COMMAND_TIMEOUT=30

# ============================================================================
# OPENAI CONFIGURATION
# ============================================================================
# OpenAI API settings for LLM-powered SQL generation and validation

# OpenAI API key (required)
# Get your key from: https://platform.openai.com/api-keys
# SECURITY: Never commit this to version control
# OPENAI_API_KEY=sk-your-openai-api-key-here

# OpenAI model to use for SQL generation
# Recommended models:
#   - gpt-5.2-mini: Fast, cost-effective, good for SQL generation
#   - gpt-4o: More accurate for complex queries, higher cost
#   - gpt-4o-mini: Balance of speed and accuracy
OPENAI_MODEL=gpt-5.2-mini

# Maximum tokens for LLM requests
# Controls the maximum length of generated SQL and responses
# gpt-5.2-mini supports up to 128k tokens context
# Recommended: 32000 for most use cases
OPENAI_MAX_TOKENS=32000

# Model temperature (0.0 = deterministic, 2.0 = creative)
# For SQL generation, use 0.0 for consistent, predictable outputs
# Higher values introduce randomness (not recommended for SQL)
OPENAI_TEMPERATURE=0.0

# API request timeout in seconds
# How long to wait for OpenAI API responses
# Recommended: 30-60 seconds
OPENAI_TIMEOUT=30

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================
# Security settings to protect your database from unauthorized operations

# Allow write operations (INSERT, UPDATE, DELETE, TRUNCATE)
# SECURITY: Keep this false in production to enforce read-only access
# Only enable if you explicitly need write capabilities
SECURITY_ALLOW_WRITE_OPERATIONS=false

# Comma-separated list of blocked PostgreSQL functions
# These functions are security risks and will be rejected during validation
# Includes: file I/O, sleep functions, admin functions, etc.
# Add additional functions as needed for your security requirements
SECURITY_BLOCKED_FUNCTIONS=pg_sleep,pg_read_file,pg_write_file,lo_import,lo_export,pg_ls_dir,pg_read_binary_file,pg_stat_file,copy_from_program,copy_to_program

# Maximum number of rows returned per query
# Prevents memory exhaustion from extremely large result sets
# Recommended: 1000-10000 depending on your use case
SECURITY_MAX_ROWS=10000

# Maximum query execution time in seconds
# Queries exceeding this time will be cancelled
# Recommended: 30-60 seconds
SECURITY_MAX_EXECUTION_TIME=30

# ============================================================================
# VALIDATION CONFIGURATION
# ============================================================================
# Settings for input validation and result verification

# Maximum question length in characters
# Prevents excessively long input that could cause issues
# Recommended: 5000-10000 characters
VALIDATION_MAX_QUESTION_LENGTH=10000

# Minimum confidence score for accepting query results (0-100)
# Results below this score will be flagged but still returned
# Higher values = stricter validation, may reject more queries
# Recommended: 70-80 for most use cases
VALIDATION_MIN_CONFIDENCE_SCORE=70

# ============================================================================
# CACHE CONFIGURATION
# ============================================================================
# Schema caching settings to improve performance

# Enable schema caching
# When enabled, database schema is cached to reduce metadata queries
# Recommended: true for production
CACHE_ENABLED=true

# Schema cache Time-To-Live in seconds
# How long to keep cached schema before refreshing
# Recommended: 3600 (1 hour) for mostly static schemas
# Use lower values if schema changes frequently
CACHE_SCHEMA_TTL=3600

# Maximum number of schemas to cache
# Controls memory usage for multi-database deployments
# Recommended: 100 (more than enough for most use cases)
CACHE_MAX_SIZE=100

# ============================================================================
# RESILIENCE CONFIGURATION
# ============================================================================
# Settings for retry logic, circuit breakers, and fault tolerance

# Maximum number of retry attempts for failed operations
# Applies to LLM API calls and transient database errors
# Recommended: 3-5 retries
RESILIENCE_MAX_RETRIES=3

# Initial retry delay in seconds
# Time to wait before first retry attempt
# Recommended: 1.0-2.0 seconds
RESILIENCE_RETRY_DELAY=1.0

# Exponential backoff factor for retries
# Each retry waits (delay * factor^attempt) seconds
# Example with factor=2.0: 1s, 2s, 4s, 8s
# Recommended: 2.0 for exponential backoff
RESILIENCE_BACKOFF_FACTOR=2.0

# Circuit breaker failure threshold
# Number of consecutive failures before opening circuit
# When circuit is open, requests fail fast without attempting operation
# Recommended: 5-10 failures
RESILIENCE_CIRCUIT_BREAKER_THRESHOLD=5

# Circuit breaker timeout in seconds
# How long to wait before attempting to close circuit (test if service recovered)
# Recommended: 60-120 seconds
RESILIENCE_CIRCUIT_BREAKER_TIMEOUT=60

# ============================================================================
# OBSERVABILITY CONFIGURATION
# ============================================================================
# Settings for metrics, logging, and monitoring

# Enable Prometheus metrics endpoint
# When enabled, metrics are exposed on the metrics port
# Recommended: true for production monitoring
OBSERVABILITY_METRICS_ENABLED=true

# Port for Prometheus metrics HTTP server
# Make sure this port is available and not blocked by firewall
# Recommended: 9090 (standard Prometheus port) or any available port
OBSERVABILITY_METRICS_PORT=9090

# Logging level
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
# DEBUG: Verbose logging for development
# INFO: Standard logging for production
# WARNING: Only warnings and errors
# ERROR: Only errors and critical issues
# Recommended: INFO for production, DEBUG for development
OBSERVABILITY_LOG_LEVEL=INFO

# Log format
# Options: json, text
# json: Structured JSON logs (recommended for production, works with log aggregators)
# text: Human-readable text logs (easier for local development)
# Recommended: json for production, text for development
OBSERVABILITY_LOG_FORMAT=json

# ============================================================================
# ENVIRONMENT
# ============================================================================
# Application environment identifier

# Environment name (development, staging, production)
# Used for conditional behavior and logging context
# Recommended: Set appropriately for each deployment
ENVIRONMENT=development

# ============================================================================
# OPTIONAL: MULTI-DATABASE CONFIGURATION
# ============================================================================
# If you need to support multiple databases, you can extend the configuration
# by adding additional DATABASE_* variables with prefixes:
#
# SECONDARY_DATABASE_HOST=other-host
# SECONDARY_DATABASE_NAME=other-db
# SECONDARY_DATABASE_USER=other-user
# SECONDARY_DATABASE_PASSWORD=other-password
#
# Note: Current implementation supports single database.
# Multi-database support requires code modifications.

# ============================================================================
# CONFIGURATION VALIDATION CHECKLIST
# ============================================================================
# Before running the server, verify:
# [ ] Database credentials are correct (test with: psql -h $HOST -U $USER -d $NAME)
# [ ] OpenAI API key is valid and has credits
# [ ] Security settings are appropriate for your use case
# [ ] Resource limits (max_rows, timeout) match your requirements
# [ ] Logging and metrics are configured for your monitoring setup
# [ ] .env file is NOT committed to version control (.gitignore contains .env)
#
# For production deployments, also verify:
# [ ] Using read-only database user
# [ ] SECURITY_ALLOW_WRITE_OPERATIONS=false
# [ ] Appropriate connection pool sizes for expected load
# [ ] Monitoring and alerting configured for metrics endpoint
# [ ] Secrets are stored in secure secret management system (not .env)
